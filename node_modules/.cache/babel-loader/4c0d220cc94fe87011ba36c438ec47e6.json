{"ast":null,"code":"import _slicedToArray from\"/home/albert/Desktop/combine-project/react-authentication/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useCallback,useEffect,useState}from\"react\";import{jsx as _jsx}from\"react/jsx-runtime\";var logoutTimer;var AuthContext=/*#__PURE__*/React.createContext({token:\"\",isLoggedIn:false,login:function login(token){},logout:function logout(){}});var calculateRemainingTime=function calculateRemainingTime(expirationTime){var currentTime=new Date().getTime();var adjExpirationTime=new Date(expirationTime).getTime();var remainingDuration=adjExpirationTime-currentTime;return remainingDuration;};var retrieveStoredToken=function retrieveStoredToken(){var storedToken=localStorage.getItem(\"token\");var storedExpirationDate=localStorage.getItem(\"expirationTime\");var remainingTime=calculateRemainingTime(storedExpirationDate);if(remainingTime<=60000){localStorage.removeItem(\"token\");localStorage.removeItem(\"expirationTime\");return null;}return{token:storedToken,duration:remainingTime};};export var AuthContextProvider=function AuthContextProvider(props){var tokenData=retrieveStoredToken();var initialToken;if(tokenData){initialToken=tokenData.token;}var _useState=useState(initialToken),_useState2=_slicedToArray(_useState,2),token=_useState2[0],setToken=_useState2[1];var userIsLoggedIn=!!token;var logoutHandler=useCallback(function(){setToken(null);localStorage.removeItem(\"token\");localStorage.removeItem(\"expirationTime\");if(logoutTimer){clearTimeout(logoutTimer);}},[]);var loginHandler=function loginHandler(token,expirationTime){setToken(token);localStorage.setItem(\"token\",token);localStorage.setItem(\"expirationTime\",expirationTime);var remainingTime=calculateRemainingTime(expirationTime);logoutTimer=setTimeout(logoutHandler,remainingTime);};useEffect(function(){if(tokenData){console.log(tokenData.duration);logoutTimer=setTimeout(logoutHandler,tokenData.duration);}},[tokenData,logoutHandler]);var contextValue={token:token,isLoggedIn:userIsLoggedIn,login:loginHandler,logout:logoutHandler};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:contextValue,children:props.children});};export default AuthContext;","map":{"version":3,"names":["React","useCallback","useEffect","useState","logoutTimer","AuthContext","createContext","token","isLoggedIn","login","logout","calculateRemainingTime","expirationTime","currentTime","Date","getTime","adjExpirationTime","remainingDuration","retrieveStoredToken","storedToken","localStorage","getItem","storedExpirationDate","remainingTime","removeItem","duration","AuthContextProvider","props","tokenData","initialToken","setToken","userIsLoggedIn","logoutHandler","clearTimeout","loginHandler","setItem","setTimeout","console","log","contextValue","children"],"sources":["/home/albert/Desktop/combine-project/react-authentication/src/store/auth-context.js"],"sourcesContent":["import React, { useCallback, useEffect, useState } from \"react\";\n\nlet logoutTimer;\n\nconst AuthContext = React.createContext({\n  token: \"\",\n  isLoggedIn: false,\n  login: (token) => {},\n  logout: () => {},\n});\n\nconst calculateRemainingTime = (expirationTime) => {\n  const currentTime = new Date().getTime();\n  const adjExpirationTime = new Date(expirationTime).getTime();\n\n  const remainingDuration = adjExpirationTime - currentTime;\n  return remainingDuration;\n};\n\nconst retrieveStoredToken = () => {\n  const storedToken = localStorage.getItem(\"token\");\n  const storedExpirationDate = localStorage.getItem(\"expirationTime\");\n\n  const remainingTime = calculateRemainingTime(storedExpirationDate);\n\n  if (remainingTime <= 60000) {\n    localStorage.removeItem(\"token\");\n    localStorage.removeItem(\"expirationTime\");\n    return null;\n  }\n  return {\n    token: storedToken,\n    duration: remainingTime,\n  };\n};\n\nexport const AuthContextProvider = (props) => {\n  const tokenData = retrieveStoredToken();\n  let initialToken;\n  if (tokenData) {\n    initialToken = tokenData.token;\n  }\n  const [token, setToken] = useState(initialToken);\n\n  const userIsLoggedIn = !!token;\n\n  const logoutHandler = useCallback(() => {\n    setToken(null);\n    localStorage.removeItem(\"token\");\n    localStorage.removeItem(\"expirationTime\");\n\n    if (logoutTimer) {\n      clearTimeout(logoutTimer);\n    }\n  }, []);\n\n  const loginHandler = (token, expirationTime) => {\n    setToken(token);\n    localStorage.setItem(\"token\", token);\n    localStorage.setItem(\"expirationTime\", expirationTime);\n    const remainingTime = calculateRemainingTime(expirationTime);\n\n    logoutTimer = setTimeout(logoutHandler, remainingTime);\n  };\n\n  useEffect(() => {\n    if (tokenData) {\n      console.log(tokenData.duration);\n      logoutTimer = setTimeout(logoutHandler, tokenData.duration);\n    }\n  }, [tokenData, logoutHandler]);\n\n  const contextValue = {\n    token: token,\n    isLoggedIn: userIsLoggedIn,\n    login: loginHandler,\n    logout: logoutHandler,\n  };\n  return (\n    <AuthContext.Provider value={contextValue}>\n      {props.children}\n    </AuthContext.Provider>\n  );\n};\n\nexport default AuthContext;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}